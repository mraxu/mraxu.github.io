---
layout: post
title:  调整根目录大小
description:
modified: 2023-07-31 17:27:19
tags: [linux]
post_type: developer
blogid: 2019107040001
categories: [linux ]
image:
  feature: posts_header/abstract-7.jpg
  credit:
  creditlink:
---
当安装完 Linux 操作系统，发现磁盘分区大小错误，或者后期使用过程发现 /home 还剩余很多空间，/ 下空间不足，需要将 /home 下空间重新分配给 / 目录下，方法如下：

### 1、查看分区空间和格式
```
[root@mongodb-1 ~]# df -hT
文件系统 类型 容量 已用 可用 已用 % 挂载点
/dev/mapper/centos-root xfs 50G 49G 1.4G 98% /
devtmpfs devtmpfs 5.8G 0 5.8G 0% /dev
tmpfs tmpfs 5.8G 0 5.8G 0% /dev/shm
tmpfs tmpfs 5.8G 602M 5.3G 11% /run
tmpfs tmpfs 5.8G 0 5.8G 0% /sys/fs/cgroup
/dev/sda1 xfs 1014M 153M 862M 16% /boot
/dev/mapper/centos-home xfs 44G 36M 44G 1% /home
tmpfs tmpfs 1.2G 0 1.2G 0% /run/user/0
```

- 这里我想要将 /home 的空闲空间分给 / 目录一部分

- 可以看到 /home 分区是 xfs 格式，这里特别注意：
```
1）ext2/ext3/ext4 文件系统的调整命令是 resize2fs（增大和减小都支持）

lvextend -L 120G /dev/mapper/centos-home // 增大至 120G
lvextend -L +20G /dev/mapper/centos-home // 增加 20G
lvreduce -L 50G /dev/mapper/centos-home // 减小至 50G
lvreduce -L -8G /dev/mapper/centos-home // 减小 8G
resize2fs /dev/mapper/centos-home // 执行调整
```
```
2）xfs 文件系统的调整命令是 xfs_growfs（只支持增大）

lvextend -L 120G /dev/mapper/centos-home // 增大至 120G
lvextend -L +20G /dev/mapper/centos-home // 增加 20G
xfs_growfs /dev/mapper/centos-home // 执行调整

就是说：xfs 文件系统只支持增大分区空间的情况，不支持减小的情况（切记！！！！！）。

硬要减小的话，只能在减小后将逻辑分区重新通过 mkfs.xfs 命令重新格式化才能挂载上，这样的话这个逻辑分区上原来的数据就丢失了。如果有重要文件，那这种方案就不能采用了～～～

这里我的 /home 下是没有数据的，所以仍然可以使用此方法。
```
```
2、卸载 /home 分区

[root@mongodb-1 /]# umount /home

查看分区

[root@mongodb-1 /]# df -h
文件系统 容量 已用 可用 已用 % 挂载点
/dev/mapper/centos-root 50G 49G 1.4G 98% /
devtmpfs 5.8G 0 5.8G 0% /dev
tmpfs 5.8G 0 5.8G 0% /dev/shm
tmpfs 5.8G 602M 5.3G 11% /run
tmpfs 5.8G 0 5.8G 0% /sys/fs/cgroup
/dev/sda1 1014M 153M 862M 16% /boot
tmpfs 1.2G 0 1.2G 0% /run/user/0

卸载成功
```
3、将 /home 分区减小 40G（根据自己实际情况设定大小） ：

[root@mongodb-1 /]# lvreduce -L -40G /dev/mapper/centos-home
WARNING: Reducing active logical volume to < 3.12 GiB.
THIS MAY DESTROY YOUR DATA (filesystem etc.)
Do you really want to reduce centos/home? [y/n]: y
Size of logical volume centos/home changed from <43.12 GiB (11038 extents) to < 3.12 GiB (798 extents).
Logical volume centos/home successfully resized.

因为 xfs 文件系统不能执行分区减小的调整！所以这里我们要执行格式化操作，

[root@mongodb-1 /]# mkfs.xfs /dev/mapper/centos-home -f
meta-data=/dev/mapper/centos-home isize=512 agcount=4, agsize=204288 blks
= sectsz=512 attr=2, projid32bit=1
= crc=1 finobt=0, sparse=0
data = bsize=4096 blocks=817152, imaxpct=25
= sunit=0 swidth=0 blks
naming =version 2 bsize=4096 ascii-ci=0 ftype=1
log =internal log bsize=4096 blocks=2560, version=2
= sectsz=512 sunit=0 blks, lazy-count=1
realtime =none extsz=4096 blocks=0, rtextents=0

重新挂载 /home 分区：

mount /dev/mapper/centos-home /home/

验证：

[root@mongodb-1 /]# df -h
文件系统 容量 已用 可用 已用 % 挂载点
/dev/mapper/centos-root 50G 49G 1.4G 98% /
devtmpfs 5.8G 0 5.8G 0% /dev
tmpfs 5.8G 0 5.8G 0% /dev/shm
tmpfs 5.8G 602M 5.3G 11% /run
tmpfs 5.8G 0 5.8G 0% /sys/fs/cgroup
/dev/sda1 1014M 153M 862M 16% /boot
tmpfs 1.2G 0 1.2G 0% /run/user/0
/dev/mapper/centos-home 3.2G 33M 3.1G 2% /home

4、查看剩余空间：

[root@mongodb-1 /]# vgdisplay
— Volume group —
VG Name centos
System ID
Format lvm2
Metadata Areas 1
Metadata Sequence No 5
VG Access read/write
VG Status resizable
MAX LV 0
Cur LV 3
Open LV 3
Max PV 0
Cur PV 1
Act PV 1
VG Size <99.00 GiB
PE Size 4.00 MiB
Total PE 25343
Alloc PE / Size 15102 / 58.99 GiB
Free PE / Size 10241 / 40.00 GiB
VG UUID 0gGHwG-Sd0c-4L0f-LNYo-5dnB-8SrH-q76ctU
image.png

5、将上面空余的 40G 分到 / 分区下

[root@mongodb-1 /]# lvextend -L +40G /dev/mapper/centos-root
Size of logical volume centos/root changed from 50.00 GiB (12800 extents) to 90.00 GiB (23040 extents).
Logical volume centos/root successfully resized.
[root@mongodb-1 /]# xfs_growfs /dev/mapper/centos-root
meta-data=/dev/mapper/centos-root isize=512 agcount=4, agsize=3276800 blks
= sectsz=512 attr=2, projid32bit=1
= crc=1 finobt=0 spinodes=0
data = bsize=4096 blocks=13107200, imaxpct=25
= sunit=0 swidth=0 blks
naming =version 2 bsize=4096 ascii-ci=0 ftype=1
log =internal bsize=4096 blocks=6400, version=2
= sectsz=512 sunit=0 blks, lazy-count=1
realtime =none extsz=4096 blocks=0, rtextents=0
data blocks changed from 13107200 to 23592960

验证：

[root@mongodb-1 /]# df -h
文件系统 容量 已用 可用 已用 % 挂载点
/dev/mapper/centos-root 90G 49G 42G 55% /
devtmpfs 5.8G 0 5.8G 0% /dev
tmpfs 5.8G 0 5.8G 0% /dev/shm
tmpfs 5.8G 602M 5.3G 11% /run
tmpfs 5.8G 0 5.8G 0% /sys/fs/cgroup
/dev/sda1 1014M 153M 862M 16% /boot
tmpfs 1.2G 0 1.2G 0% /run/user/0
/dev/mapper/centos-home 3.2G 33M 3.1G 2% /home

调整分区完成。
